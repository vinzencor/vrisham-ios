<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Test</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 300px;
            padding: 8px;
            margin-right: 10px;
        }
        button {
            padding: 8px 16px;
            background: #73338A;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #5a2a6b;
        }
        .info {
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Google Maps Location Selection Test</h1>
    
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Search for places...">
        <button onclick="searchPlaces()">Search</button>
        <button onclick="getCurrentLocation()">Get Current Location</button>
    </div>
    
    <div id="map"></div>
    
    <div class="info">
        <h3>Selected Location:</h3>
        <p id="selectedLocation">Click on the map or search for a place</p>
        <p id="coordinates"></p>
    </div>

    <script>
        let map;
        let marker;
        let geocoder;
        let placesService;

        function initMap() {
            console.log('Initializing Google Maps...');
            
            // Initialize map centered on Chennai (default location)
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 13.0827, lng: 80.2707 },
                zoom: 12,
                clickableIcons: true,
                gestureHandling: 'greedy'
            });

            // Initialize services
            geocoder = new google.maps.Geocoder();
            placesService = new google.maps.places.PlacesService(map);

            // Create marker
            marker = new google.maps.Marker({
                position: { lat: 13.0827, lng: 80.2707 },
                map: map,
                draggable: true,
                title: 'Selected Location'
            });

            // Add click listener to map
            map.addListener('click', function(event) {
                const position = {
                    lat: event.latLng.lat(),
                    lng: event.latLng.lng()
                };
                updateMarkerPosition(position);
                reverseGeocode(position);
            });

            // Add drag listener to marker
            marker.addListener('dragend', function(event) {
                const position = {
                    lat: event.latLng.lat(),
                    lng: event.latLng.lng()
                };
                reverseGeocode(position);
            });

            console.log('Google Maps initialized successfully');
            
            // Get initial address
            reverseGeocode({ lat: 13.0827, lng: 80.2707 });
        }

        function updateMarkerPosition(position) {
            marker.setPosition(position);
            map.panTo(position);
            document.getElementById('coordinates').textContent = 
                `Coordinates: ${position.lat.toFixed(6)}, ${position.lng.toFixed(6)}`;
        }

        function reverseGeocode(position) {
            console.log('Reverse geocoding:', position);
            
            geocoder.geocode({ location: position }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const address = results[0].formatted_address;
                    document.getElementById('selectedLocation').textContent = address;
                    console.log('Address found:', address);
                } else {
                    console.error('Reverse geocoding failed:', status);
                    document.getElementById('selectedLocation').textContent = 'Unable to get address';
                }
            });
        }

        function searchPlaces() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            console.log('Searching for:', query);

            const request = {
                query: query + ' India',
                bounds: new google.maps.LatLngBounds(
                    new google.maps.LatLng(6.4627, 68.1097),
                    new google.maps.LatLng(35.5044, 97.3953)
                ),
                region: 'IN'
            };

            placesService.textSearch(request, function(results, status) {
                console.log('Search results:', status, results);
                
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                    const place = results[0];
                    const position = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };
                    
                    updateMarkerPosition(position);
                    map.setZoom(16);
                    
                    document.getElementById('selectedLocation').textContent = 
                        place.formatted_address || place.name;
                    
                    console.log('Place found:', place);
                } else {
                    alert('No places found for: ' + query);
                }
            });
        }

        function getCurrentLocation() {
            console.log('Getting current location...');
            
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const coords = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    console.log('Current location:', coords);
                    updateMarkerPosition(coords);
                    map.setZoom(16);
                    reverseGeocode(coords);
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    alert('Unable to get your current location: ' + error.message);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        // Handle search input enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPlaces();
            }
        });
    </script>

    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6DZgq0n6pQ7UAtbQiuD6o1TJTx4b947s&libraries=places&callback=initMap">
    </script>
</body>
</html>
